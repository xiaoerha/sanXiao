require=function n(e,t,o){function a(i,r){if(!t[i]){if(!e[i]){var c="function"==typeof require&&require;if(!r&&c)return c(i,!0);if(l)return l(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var f=t[i]={exports:{}};e[i][0].call(f.exports,function(n){var t=e[i][1][n];return a(t?t:n)},f,f.exports,n,e,t,o)}return t[i].exports}for(var l="function"==typeof require&&require,i=0;i<o.length;i++)a(o[i]);return a}({blank:[function(n,e,t){"use strict";cc._RFpush(e,"91312j1XWNEpbj+K3yXK336","blank"),cc.Class({"extends":cc.Component,properties:{_spriteFrameArr:[],_type:0,_selfI:0,_selfJ:0,_selectPic:null,_oldCell:null,_isSelect:!1,_fallDownNum:0,arrIndex:0,_touchClick:0,_isSpecial:!1},onLoad:function(){var n=this;this._touchClick=this.node.on(cc.Node.EventType.TOUCH_START,function(e){n._oldCell=e.currentTarget;var t=cc.find("script");t.emit("clickBlank",n._oldCell)}),this.node.on("clearUp",function(e){var t=cc.sequence(cc.blink(1,3),cc.callFunc(function(){GameConfig.blanksArr[n._selfI][n._selfJ].removeFromParent(!0),GameConfig.blanksArr[n._selfI][n._selfJ]=null;var e=cc.find("script");e.emit("myfallDown")}));n.node.runAction(t)});var e=cc.find("script");e.on("closeClick",function(){cc.log(666),n.node.off(cc.Node.EventType.TOUCH_START,n._touchClick)}),e.on("openClick",function(){n.node.on(cc.Node.EventType.TOUCH_START,n._touchClick)})},init:function(n,e,t){this._spriteFrameArr=n,this._type=~~(Math.random()*GameConfig.blank_type),this.getComponent(cc.Sprite).spriteFrame=this._spriteFrameArr[this._type],this._selfI=e,this._selfJ=t},checkSameColor:function(n){this._type=n},blankType:function(){return this._type},randomColor:function(){return this._type=~~(Math.random()*GameConfig.blank_type),this.node.getComponent(cc.Sprite).spriteFrame=this._spriteFrameArr[this._type],this._type},showInfo:function(){return{i:this._selfI,j:this._selfJ,type:this._type}},runTocell:function(n,e,t){this._selfI=e,this._selfJ=t,this.node.runAction(cc.moveTo(.5,n.getPosition()))},setArrIndex:function(){return this.arrIndex=cc.p(this._selfI,this._selfJ),this.arrIndex},changeCellSelect:function(n){n?null==this._selectPic&&(this.node.scale=1.2):(this.node.scale=1,null!=this._selectPic&&(this._selectPic.active=!1,this._selectPic=null))},setFallNum:function(n){this._fallDownNum=n},fallDown:function(){return this._selfJ-=this._fallDownNum,this.node.runAction(cc.moveBy(.5,cc.p(0,-70*this._fallDownNum))),this._fallDownNum},resetSpecial:function(){this.node.scale=1,this._isSpecial=!1},setToSpecial:function(){this.node.scale=.8,this._isSpecial=!0}}),cc._RFpop()},{}],main:[function(n,e,t){"use strict";cc._RFpush(e,"55d1bYV7MZAbJeLhuS4atNP","main"),window.GameConfig={changeBlank1:0,changeBlank2:0,blank_w:8,blank_h:8,blank_width:70,blank_type:7,startPx:-300,startPy:-250,blanksArr:[],Event:{clickBlank:"click_blank"},_checkSameArr:[]},cc.Class({"extends":cc.Component,properties:{blanks:[cc.SpriteFrame],blank_prefab:cc.Prefab,_newCell:null,_cellArr:null,_tempAdd:0,_promptCellArr:[],_select:null,_score:0,audio:{url:cc.AudioClip,"default":null},_current:null,_isClick:!0},onLoad:function(){this._current=cc.audioEngine.play(this.audio,!0,1),GameConfig.blanksArr=[];for(var n=0;n<GameConfig.blank_w;n++){for(var e=[],t=0;t<GameConfig.blank_h;t++)e.push(null);GameConfig.blanksArr.push(e)}this._buildRandom(),this.buildRandomWithout3();var o=this;this.node.on("clickBlank",function(n){var e=n.getUserData();o.checkArr(e)}),this.node.on("myfallDown",function(){o.myFallDown()})},_buildRandom:function(){for(var n=cc.find("script"),e=0;e<GameConfig.blank_w;e++)for(var t=0;t<GameConfig.blank_h;t++){var o=cc.instantiate(this.blank_prefab);o.x=GameConfig.startPx+e*GameConfig.blank_width,o.y=GameConfig.startPy+t*GameConfig.blank_width,n.addChild(o),o.getComponent("blank").init(this.blanks,e,t),GameConfig.blanksArr[e][t]=o}this.traceArr()},deleteSame:function(n,e){for(var t=n.concat(e),o=0;o<t.length;o++)for(var a=t[o],l=o+1;l<t.length;l++)cc.pSameAs(t[l],a)&&(t.splice(l,1),l--);return t},buildRandomWithout3:function(){this._count++;var n=this.checkWithout3();if(cc.log("第几次生成:",this._count,n.length),n.length>0){for(var e in n){var t=n[e].getComponent("blank").showInfo();GameConfig.blanksArr[t.i][t.j].getComponent("blank").randomColor()}this.buildRandomWithout3()}else cc.log("生成成功")},checkWithout3:function(){for(var n=[],e=0;e<GameConfig.blank_w;e++)for(var t=0;t<GameConfig.blank_h;t++)e<GameConfig.blank_w-2&&GameConfig.blanksArr[e][t].getComponent("blank").blankType()==GameConfig.blanksArr[e+1][t].getComponent("blank").blankType()&&GameConfig.blanksArr[e+1][t].getComponent("blank").blankType()==GameConfig.blanksArr[e+2][t].getComponent("blank").blankType()&&n.push(GameConfig.blanksArr[e][t],GameConfig.blanksArr[e+1][t],GameConfig.blanksArr[e+2][t]),t<GameConfig.blank_h-2&&GameConfig.blanksArr[e][t].getComponent("blank").blankType()==GameConfig.blanksArr[e][t+1].getComponent("blank").blankType()&&GameConfig.blanksArr[e][t+1].getComponent("blank").blankType()==GameConfig.blanksArr[e][t+2].getComponent("blank").blankType()&&n.push(GameConfig.blanksArr[e][t],GameConfig.blanksArr[e][t+1],GameConfig.blanksArr[e][t+2]);return n=this.deleteSame(n,[])},traceArr:function(){for(var n=0;n<GameConfig.blanksArr.length;n++)for(var e="",t=0;t<GameConfig.blanksArr[n].length;t++)e+=GameConfig.blanksArr[n][t]+","},checkArr:function(n){if(null==this._newCell)this._newCell=n,n.getComponent("blank").changeCellSelect(!0);else{if(this._newCell==n)return n.getComponent("blank").changeCellSelect(!1),cc.log(111),void(this._newCell=null);this._newCell.getComponent("blank").setArrIndex().x!=n.getComponent("blank").setArrIndex().x&&this._newCell.getComponent("blank").setArrIndex().y!=n.getComponent("blank").setArrIndex().y||1!=Math.abs(this._newCell.getComponent("blank").setArrIndex().x+this._newCell.getComponent("blank").setArrIndex().y-n.getComponent("blank").setArrIndex().x-n.getComponent("blank").setArrIndex().y)?(this._newCell.getComponent("blank").changeCellSelect(!1),n.getComponent("blank").changeCellSelect(!0),this._newCell=n):(this.change2Cell(this._newCell,n,!0),this.node.emit("closeClick"),this._newCell.getComponent("blank").changeCellSelect(!1),this._newCell=null)}},change2Cell:function(n,e,t){this.node.emit("openClick");var o=cc.instantiate(e),a=n.getComponent("blank").showInfo(),l=e.getComponent("blank").showInfo();GameConfig.blanksArr[a.i][a.j]=e,GameConfig.blanksArr[l.i][l.j]=n,n.getComponent("blank").runTocell(o,l.i,l.j),e.getComponent("blank").runTocell(n,a.i,a.j),t&&this.scheduleOnce(function(){var t=this.checkWithout3();if(cc.log(t),0==t.length)this.change2Cell(n,e,!1);else{var o=null;t.length>=4&&(o=n),this.cellFallDown(t,o)}},.5)},cellFallDown:function(n,e){var t=[];for(var o in n){var a=n[o];if(1==GameConfig.blanksArr[a.getComponent("blank").showInfo().i][a.getComponent("blank").showInfo().j].getComponent("blank")._isSpecial){for(var l=0;l<GameConfig.blank_w;l++)t.push(GameConfig.blanksArr[l][a.getComponent("blank").showInfo().j]);GameConfig.blanksArr[a.getComponent("blank").showInfo().i][a.getComponent("blank").showInfo().j].getComponent("blank").resetSpecial()}}n=this.deleteSame(n,t),e&&e.getComponent("blank").setToSpecial();for(var o in n){var a=n[o];GameConfig.blanksArr[a.getComponent("blank").showInfo().i][a.getComponent("blank").showInfo().j]!=e&&a.emit("clearUp")}},myFallDown:function(){for(var n=0;n<GameConfig.blank_w;n++)for(var e=0;e<GameConfig.blank_h;e++){var t=GameConfig.blanksArr[n][e];if(t){if(this._tempAdd=0,e>0)for(var o=e-1;o>=0;o--)null==GameConfig.blanksArr[n][o]&&(this._tempAdd++,cc.log(this._tempAdd));t.getComponent("blank").setFallNum(this._tempAdd)}}for(var n=0;n<GameConfig.blank_w;n++)for(var e=0;e<GameConfig.blank_h;e++){var t=GameConfig.blanksArr[n][e];if(t){var a=t.getComponent("blank").fallDown(),l=GameConfig.blanksArr[n][e];GameConfig.blanksArr[n][e]=GameConfig.blanksArr[n][e-a],GameConfig.blanksArr[n][e-a]=l}}this.scheduleOnce(function(){this.fillEmpty()},.51)},fillEmpty:function(){for(var n=0;n<GameConfig.blank_w;n++)for(var e=0;e<GameConfig.blank_h;e++)if(null==GameConfig.blanksArr[n][e]){var t=cc.instantiate(this.blank_prefab);t.getComponent("blank").init(this.blanks,n,e),t.setPosition(GameConfig.startPx+70*n,GameConfig.startPy+70*e),this.node.addChild(t),GameConfig.blanksArr[n][e]=t}var o=this.checkWithout3();if(0==o.length){this.node.emit("openClick");var a=cc.find("Canvas/view");a.active=!0}else{var a=cc.find("Canvas/view");a.active=!1,this.scheduleOnce(function(){this.cellFallDown(o)},.51)}},prompt:function(){this._select=!0;for(var n=0;n<GameConfig.blank_w;n++)for(var e=0;e<GameConfig.blank_h;e++)this._select&&this.viewPromt(GameConfig.blanksArr[n][e])},checkIsSame:function(){for(var n=0;n<GameConfig.blank_w;n++)for(var e=0;e<GameConfig.blank_h;e++){if(n<GameConfig.blank_w-2&&GameConfig.blanksArr[n][e].getComponent("blank").blankType()==GameConfig.blanksArr[n+1][e].getComponent("blank").blankType()&&GameConfig.blanksArr[n+1][e].getComponent("blank").blankType()==GameConfig.blanksArr[n+2][e].getComponent("blank").blankType()){this._select=!1;break}if(e<GameConfig.blank_h-2&&GameConfig.blanksArr[n][e].getComponent("blank").blankType()==GameConfig.blanksArr[n][e+1].getComponent("blank").blankType()&&GameConfig.blanksArr[n][e+1].getComponent("blank").blankType()==GameConfig.blanksArr[n][e+2].getComponent("blank").blankType()){this._select=!1;break}}},viewPromt:function(n){cc.log(n);for(var e=n.getComponent("blank").showInfo(),t=e.type,o=cc.p(e.i,e.j),a=[cc.p(0,1),cc.p(0,-1),cc.p(-1,0),cc.p(1,0)],l=0;l<a.length;l++){var i=a[l],r=cc.pAdd(i,o);if(GameConfig.blanksArr[r.x]&&GameConfig.blanksArr[r.x][r.y]){var c=GameConfig.blanksArr[r.x][r.y].getComponent("blank").showInfo().type;if(n.getComponent("blank").checkSameColor(c),GameConfig.blanksArr[r.x][r.y].getComponent("blank").checkSameColor(t),this.checkIsSame(),n.getComponent("blank").checkSameColor(t),GameConfig.blanksArr[r.x][r.y].getComponent("blank").checkSameColor(c),0==this._select)return n.scale=1.3,GameConfig.blanksArr[r.x][r.y].scale=1.3,void this.scheduleOnce(function(){n.scale=1,GameConfig.blanksArr[r.x][r.y].scale=1},.5)}}},playOffMusic:function(){this._isClick?(cc.audioEngine.pause(this._current),this._isClick=!1):(cc.audioEngine.resume(this._current),this._isClick=!0)},update:function(n){}}),cc._RFpop()},{}],view:[function(n,e,t){"use strict";cc._RFpush(e,"6b872Gc6tVNErtGFzOjSH5P","view"),cc.Class({"extends":cc.Component,properties:{music:{url:cc.AudioClip,"default":null},_nowPlay:null,_clickOn:!0},onLoad:function(){this._nowPlay=cc.audioEngine.play(this.music,!1,1)},beginGame:function(){cc.director.loadScene("game"),cc.audioEngine.uncacheAll()},playOffMusic:function(){this._clickOn?(cc.audioEngine.pause(this._nowPlay),this._clickOn=!1):(cc.audioEngine.resume(this._nowPlay),this._clickOn=!0)},update:function(n){}}),cc._RFpop()},{}]},{},["view","blank","main"]);